# 產品需求文檔 (PRD)

## 產品名稱：阿爸的芋圓 — 門店盤點叫貨 & 中央廚房生產出貨庫存管理系統

**版本**：v1.0 (MVP)
**建立日期**：2026-02-17
**產品經理**：AI Product Manager

---

## 一、產品概述

### 1.1 產品簡介
「阿爸的芋圓」營運管理系統，是一套專為連鎖甜品店設計的 **門店打烊盤點、叫貨、每日結帳** 及 **中央廚房生產出貨、原物料與成品庫存管理** 的數位化系統。各角色透過手機掃描 QR Code 即可操作對應功能，取代現有紙本與 Google 表單流程。

### 1.2 核心問題
- **紙筆盤點易出錯**：品項順序不流暢，手寫數量辨識困難，填寫耗時。
- **叫貨無依據**：缺乏每日用量數據輔助，經常叫多或叫少。
- **中央廚房資訊不即時**：上班時無法快速看到各店叫貨需求與加總數量。
- **缺乏系統化報表**：營業額、用量、損耗、庫存等數據分散在紙本和 Google 表單中，無法快速彙總分析。
- **無完整出貨記錄**：央廚每日出貨、各店收貨缺乏數位化確認機制。

### 1.3 產品目標
- 將門店打烊盤點時間縮短 50% 以上，降低人為填寫錯誤。
- 提供叫貨量自動建議，減少庫存積壓與缺貨風險。
- 中央廚房即時查看各店叫貨需求及加總，提升生產效率。
- 建立完整的數據鏈：盤點 → 用量計算 → 叫貨 → 出貨 → 收貨確認。
- 為管理者提供日報、週報、月報。

---

## 二、用戶畫像

### 2.1 門店人員
| 項目 | 描述 |
|------|------|
| 角色 | 門店店員 |
| 使用場景 | 每日打烊後（約 23:30 後），用手機掃 QR Code 進行物料盤點 |
| 使用裝置 | 個人手機（iOS / Android），手機瀏覽器 |
| 核心需求 | 快速、直覺地輸入各品項庫存數量與倒掉量 |

### 2.2 門店店長
| 項目 | 描述 |
|------|------|
| 角色 | 門店店長 |
| 使用場景 | 打烊後掃 QR Code 填寫叫貨、當日結帳、上班人數、配料使用量與損耗量、營業號數及營業額 |
| 使用裝置 | 個人手機，手機瀏覽器 |
| 核心需求 | 一站式完成每日結帳與叫貨，系統提供叫貨建議量 |

### 2.3 中央廚房管理人員
| 項目 | 描述 |
|------|------|
| 角色 | 央廚管理人員 |
| 使用場景 | 每日上班後掃 QR Code 查看各店叫貨需求、管理庫存、安排生產與出貨 |
| 使用裝置 | 個人手機，手機瀏覽器 |
| 核心需求 | 快速看到各店叫貨加總、成品庫存、原物料庫存及最低庫存警示 |

### 2.4 老闆 / 管理者
| 項目 | 描述 |
|------|------|
| 角色 | 老闆 |
| 使用場景 | 隨時掃 QR Code 查看各項報表與營運數據 |
| 使用裝置 | 個人手機，手機瀏覽器 |
| 核心需求 | 查看營業額、上班人數、訂單數量、庫存總覽、日週月報 |

---

## 三、功能清單

### 3.1 門店端 — 打烊盤點模組（手機 Web）

| 優先級 | 功能 | 描述 |
|--------|------|------|
| P0 | QR Code 掃碼進入 | 各店專屬 QR Code，掃碼後自動識別門店，進入該店盤點頁面 |
| P0 | 物料盤點表 | 依品項分組排列，每個品項輸入：架上數量、庫存數量、倒掉量、備註 |
| P0 | 品項分組顯示 | 按分類順序流暢排列（詳見 3.7 品項清單），支援快速滑動 |
| P0 | 數量快捷輸入 | 數字鍵盤直接輸入，支援小數點（如 0.5 桶），點擊欄位即彈出數字鍵盤 |
| P0 | 日期自動帶入 | 自動帶入當天日期，不可修改 |
| P0 | 提交確認 | 盤點完成後一鍵提交，提交前可預覽確認 |
| P1 | 歷史盤點查看 | 可查看過去的盤點紀錄 |

### 3.2 門店端 — 每日結帳模組（手機 Web）

| 優先級 | 功能 | 描述 |
|--------|------|------|
| P0 | 結帳金額輸入 | 輸入當日結帳金額（POS 機結帳總額） |
| P0 | 扣除項輸入 | 電腦發票退款、開店佰鈔、開店零錢 |
| P0 | 支付方式明細 | 遊悠付、台灣PAY、全支付、LINEPAY、零用金申請、發票退款、前日未存入金額、換零錢 |
| P0 | 外送平台費用 | UBER 訂單費用、foodpanda 訂單費用 |
| P0 | 其它收支 | 其它支出（金額+說明）、其它收入（金額+說明） |
| P0 | 應結總金額計算 | 系統自動計算：結帳金額 - 各扣除項 = 當日應結總金額 |
| P0 | 實收盤點 | 仟鈔(張數×1000)、伍佰鈔(張數×500)、佰鈔(張數×100)、50元、10元、5元、1元 → 自動加總鈔票總額 |
| P0 | 鐵櫃內盤點 | 仟鈔(張數)、佰鈔(張數)、50元(盒數×3000)、10元(盒數×1000)、5元(盒數×500) → 自動計算總額 |
| P0 | 自動計算欄位 | 當日實收總結金額、當日結帳差額、次日零用金、前日餘額、今日餘額 |
| P0 | 營運資訊 | 今日號數（訂單數）、當日上班人力 |

### 3.3 門店端 — 每日用量及損耗表（手機 Web）

| 優先級 | 功能 | 描述 |
|--------|------|------|
| P0 | 用量自動計算 | 前日用量 = 前日庫存 + 當日央廚備料 - 當日庫存 - 當日倒掉量（系統自動計算） |
| P0 | 倒掉量輸入 | 各品項的當日損耗/倒掉數量 |
| P0 | 庫存顯示 | 顯示當日盤點後的庫存數量 |
| P0 | 央廚備料顯示 | 顯示當日央廚出貨到該店的備料數量 |
| P0 | 總量計算 | 自動計算總量（庫存 + 央廚備料） |
| P0 | 備註欄 | 顯示各品項的基本量與保存天數（如：基本量:2盒/2天） |
| P1 | 天氣與溫度記錄 | 記錄當日天氣、降雨機率、溫度範圍（影響用量分析） |

### 3.4 門店端 — 叫貨模組（手機 Web）

| 優先級 | 功能 | 描述 |
|--------|------|------|
| P0 | 叫貨表單 | 各品項的叫貨數量輸入，帶有品項單位（盒、桶、袋、壺、瓶等） |
| P0 | 自動建議叫貨量 | 根據近 7 天平均每日用量 + 基本庫存量，系統自動計算建議叫貨量供參考 |
| P0 | 當前庫存顯示 | 旁邊顯示剛盤完的庫存數量，方便店長判斷 |
| P0 | 叫貨提交 | 店長確認後提交叫貨單，時間記錄為打烊當日（隔天到貨） |
| P1 | 叫貨歷史 | 查看過去叫貨紀錄 |

### 3.5 中央廚房端（手機 Web）

| 優先級 | 功能 | 描述 |
|--------|------|------|
| P0 | 各店叫貨總表 | 顯示各店（樂華、興南）各品項叫貨量 + 自動加總，一頁清楚呈現 |
| P0 | 當日總備料表 | 依品項顯示：當日總備料量、各店需求量、央廚庫存 |
| P0 | 成品庫存盤點 | 央廚成品/半成品庫存輸入與查看（嫩仙草、銀耳湯、紫米紅豆湯、豆花、芋圓、白玉、粉圓等） |
| P0 | 出貨表 | 記錄每日出貨到各店的品項與數量，可勾選確認出貨 |
| P0 | 原物料庫存盤點 | 依分類（雜糧、堅果、乾貨、罐裝、袋裝等）輸入庫存量 |
| P0 | 原物料叫貨 | 輸入各原物料的叫貨量，顯示散裝量、上週用量供參考 |
| P0 | 最低庫存警示 | 原物料低於最低庫存量時，以紅色標示提醒 |
| P1 | 生產排程參考 | 依品項保存天數提示生產週期（每日生產 / 2-3天 / 3-7天） |

### 3.6 各店收貨確認（手機 Web）

| 優先級 | 功能 | 描述 |
|--------|------|------|
| P0 | 收貨確認 | 門店人員上班後掃 QR Code，查看當日央廚出貨清單，逐項確認後點擊「確認收貨」 |
| P1 | 差異回報 | 如實收數量與出貨數量不符，可填寫差異備註 |

### 3.7 品項清單（依實際表格整理）

#### 門店盤點 / 叫貨品項

**配料類（盒裝）**
| 品項 | 單位 | 保存天數 | 基本量 |
|------|------|----------|--------|
| 紅豆 | 盒 | 7天 | 2盒/2天 |
| 綠豆 | 盒 | 7天 | 2盒/2天 |
| 花生 | 盒 | 7天 | 2盒/5天 (3.5Kg) |
| 小薏仁 | 盒 | 7天 | 1桶/3天 (1.35Kg) |

**加工品類（盒/袋）**
| 品項 | 單位 | 保存天數 | 基本量 |
|------|------|----------|--------|
| 芋泥球 | 盒 | 3天 | 1盒/2天 |
| 芋泥漿 | 袋 | 7天 | 0.5桶/2天 |
| 嫩仙草 | 桶 | 4天 | 1桶/1天 |
| 紫米紅豆湯 | 桶 | — | 0.5桶/1天 |
| 銀耳湯 | 桶 | 3天 | 1桶/1天 |
| 芝麻糊 | CC | — | 0.25桶/2天 (真空5天) |

**主食類（袋裝）**
| 品項 | 單位 | 保存天數 | 基本量 |
|------|------|----------|--------|
| 芋圓 | 袋 | 冷凍45天 | 3000g/袋 |
| 白玉 | 袋 | — | 3000g/袋 |
| 粉圓 | 袋 | — | 3000g/袋 (6袋) |

**液體類**
| 品項 | 單位 | 保存天數 | 基本量 |
|------|------|----------|--------|
| 粉圓糖水 | 壺 | — | 15斤/壺 |
| 炒糖糖水 | 壺 | — | 4800/壺 |
| 芝麻湯圓 | 盒/箱 | — | 3袋/箱 |
| 鮮奶 | 瓶 | 10天 | 20瓶/箱 |
| 薑汁 | 瓶 | — | — |
| 微糖豆漿 | 袋 | 開封3天 | 2500g/袋 (14天) |
| 無糖豆漿 | 袋 | 開封3天 | 2500g/袋 (14天) |
| 豆花(冷) | 桶 | 4天 | 基本量0.5桶/3天 |
| 豆花(熱) | 桶 | — | — |
| 杏仁茶 | CC | 7天 | — |

**冰品類**
| 品項 | 單位 | 保存天數 | 基本量 |
|------|------|----------|--------|
| 花生冰淇淋(盒) | 盒 | 6個月 | 1盒/2週 (3800g) |
| 芝麻冰淇淋(盒) | 盒 | 6個月 | — |
| 花生冰淇淋(杯) | 杯 | — | — |
| 芝麻冰淇淋(杯) | 杯 | — | — |
| 草莓冰淇淋(杯) | 杯 | — | — |
| 蔗片冰 | 袋 | — | — |

**其他**
| 品項 | 單位 | 備註 |
|------|------|------|
| 紅豆料(0.5桶) | 份 | — |
| 紅豆料(1桶) | 份 | — |
| 冷凍薑汁 | 瓶 | 冷藏7天 |
| 豆花糖水 | 桶 | — |

#### 央廚原物料品項（依分類）

**雜糧類**
| 品名 | 規格 | 單位 |
|------|------|------|
| 綠豆(天鶴牌) | 50斤/袋 | 袋 |
| 紅豆(台灣) | 50斤/袋 | 袋 |
| 小薏仁(珍珠麥) | 25斤/袋 | 袋 |
| 二砂 | 50斤/袋 | 袋 |
| 大PS紅糖(黑糖) | 50斤/袋 | 袋 |
| 精製特砂(白砂) | — | 袋 |
| 冰糖 | 50斤/袋 (10包) | 袋 |
| 三花樹薯粉(太白粉) | 50斤/袋 | 袋 |
| 光中杏仁粉(杏仁茶) | 1箱8包 | 包 |
| 長糯米 | 50斤/袋 | 袋 |
| 圓糯米 | — | 袋 |
| 紫米 | — | 袋 |
| 聖旻陣薏仁片 | 50斤/袋 | 袋 |

**堅果類**
| 品名 | 規格 | 單位 |
|------|------|------|
| 部落米 | 20斤/袋 | 袋 |
| 進口(生)花生片 | — | 袋 |
| 大黑芝麻(粒) | 10斤/包 | 包 |

**乾貨類**
| 品名 | 規格 | 單位 | 備註 |
|------|------|------|------|
| 3號銀耳 | 半斤/包，乾貨滿7000免運 | 包 | 銀耳湯料 |
| 1.5紅棗 | 5斤/包 | 包 | — |
| 0.5枸杞 | — | 包 | — |

**罐裝/袋裝類**
| 品名 | 規格 | 單位 |
|------|------|------|
| 狀元仙草 | 1箱6瓶，叫貨最少7箱 | 箱 |
| 東城門仙草 | 1箱4袋，一次8箱 | 袋 |
| 新地瓜粉 | 20公斤 | 包 |
| 粉粿粉 | 20公斤 | 包 |

**其他供應商**
| 品名 | 規格 | 單位 |
|------|------|------|
| A2 | — | 包 |
| 天然熟石灰 | 1公斤/袋裝 | 包 |
| 甘蔗原汁 | 6瓶/箱 | 箱 |
| 花生醬 | — | 包 |
| 鮮奶 | 1箱20瓶 | 箱 |
| 冰淇淋液 | 1箱12瓶 | 瓶 |

### 3.8 老闆/管理者端（手機 Web）

| 優先級 | 功能 | 描述 |
|--------|------|------|
| P1 | 每日營運總覽 | 各店營業額、號數、人力、結帳差額一覽 |
| P1 | 庫存總覽 | 各店物料庫存、央廚成品與原物料庫存 |
| P1 | 日報 | 當日各店營業額、用量、損耗、叫貨彙總 |
| P2 | 週報 | 週度營業額趨勢、品項用量趨勢、損耗統計 |
| P2 | 月報 | 月度營業額報表、原物料採購統計、成本分析 |

---

## 四、業務流程

### 4.1 每日門店打烊流程

```
門店打烊 (23:30 後)
   │
   ▼
店員掃 QR Code → 進入盤點頁面
   │
   ▼
逐品項輸入：架上數量、庫存數量、倒掉量
   │
   ▼
提交盤點表 → 系統自動計算每日用量
   │
   ▼
店長掃 QR Code → 進入結帳 & 叫貨頁面
   │
   ├── 填寫每日結帳表（各支付方式金額、實收盤點）
   │
   ├── 填寫營運資訊（號數、人力）
   │
   └── 填寫叫貨單（系統提供建議量，店長可調整）
   │
   ▼
提交結帳表 + 叫貨單
```

### 4.2 中央廚房每日流程

```
央廚人員上班 → 掃 QR Code
   │
   ▼
查看各店叫貨總表（各店需求 + 加總）
   │
   ▼
確認當日備料量 → 安排生產
   │
   ▼
生產完成 → 填寫出貨表（各店出貨品項與數量）
   │
   ▼
確認出貨 → 系統更新央廚成品庫存
   │
   ▼
各店上班人員掃 QR Code → 確認收貨
```

### 4.3 央廚原物料管理流程

```
央廚人員盤點原物料庫存
   │
   ▼
系統檢查是否低於最低庫存量
   │
   ├── 是 → 紅色警示，提醒叫貨
   │
   └── 否 → 正常顯示
   │
   ▼
填寫原物料叫貨單（顯示上週用量供參考）
   │
   ▼
提交叫貨單
```

### 4.4 叫貨建議量計算邏輯

```
建議叫貨量 = 基本庫存量 - 當前庫存 + 近7日平均每日用量

其中：
- 基本庫存量：各品項設定的安全庫存（如：紅豆 基本量 2盒/2天）
- 當前庫存：今日盤點後的庫存數量
- 近7日平均每日用量：過去7天用量的平均值

若計算結果 ≤ 0，則建議叫貨量 = 0
```

---

## 五、QR Code 入口設計

| 角色 | QR Code 內容 | 說明 |
|------|-------------|------|
| 門店店員（盤點） | `https://domain.com/store/{store_id}/inventory` | 進入該店盤點頁面 |
| 門店店長（結帳+叫貨） | `https://domain.com/store/{store_id}/manager` | 進入結帳與叫貨頁面 |
| 央廚人員 | `https://domain.com/kitchen` | 進入央廚管理頁面 |
| 門店收貨確認 | `https://domain.com/store/{store_id}/receive` | 進入收貨確認頁面 |
| 老闆 | `https://domain.com/admin` | 進入管理報表頁面 |

**門店代碼：**
- `lehua` — 樂華店
- `xingnan` — 興南店
- 未來新店可動態新增

---

## 六、技術架構

| 項目 | 技術選型 |
|------|----------|
| 前端框架 | React + TypeScript + Vite |
| UI 元件庫 | shadcn/ui + Tailwind CSS |
| 後端 / 資料庫 | Supabase（PostgreSQL + Auth + Realtime） |
| 部署平台 | Netlify |
| 手機適配 | 響應式 Mobile-first 設計 |

---

## 七、資料結構概覽

### 7.1 核心資料表

| 資料表 | 用途 | 主要欄位 |
|--------|------|----------|
| `stores` | 門店資料 | id, name, code, address |
| `users` | 使用者 | id, name, role, store_id |
| `products` | 品項主檔 | id, name, category, unit, shelf_life_days, base_stock, notes |
| `raw_materials` | 原物料主檔 | id, name, category, spec, unit, min_stock, supplier |
| `daily_inventory` | 每日盤點紀錄 | id, store_id, date, product_id, on_shelf, stock, discarded, notes |
| `daily_settlement` | 每日結帳 | id, store_id, date, pos_total, payment_details(JSON), cash_count(JSON), order_count, staff_count |
| `daily_usage` | 每日用量 | id, store_id, date, product_id, prev_usage, discarded, stock, kitchen_supply, total |
| `store_orders` | 門店叫貨單 | id, store_id, date, product_id, suggested_qty, actual_qty, status |
| `kitchen_shipments` | 央廚出貨 | id, date, store_id, product_id, quantity, confirmed_by, confirmed_at |
| `kitchen_inventory` | 央廚成品庫存 | id, date, product_id, quantity |
| `raw_material_inventory` | 原物料庫存 | id, date, material_id, quantity, weekly_usage |
| `raw_material_orders` | 原物料叫貨 | id, date, material_id, quantity, notes |
| `weather_records` | 天氣記錄 | id, date, weather, rain_prob, temp_range |

---

## 八、非功能性需求

| 項目 | 需求描述 |
|------|----------|
| Mobile-first | 所有操作頁面皆以手機螢幕為主要設計，確保手指操作友善 |
| 數字輸入優化 | 數量輸入欄位自動彈出數字鍵盤，支援小數（如 0.5、3.2） |
| 離線提示 | 網路斷線時提示用戶，避免資料遺失 |
| 操作速度 | 盤點頁面載入 < 2 秒，提交回應 < 1 秒 |
| 資料安全 | Supabase Row Level Security，各店僅能存取自己的資料 |
| 瀏覽器相容 | 支援 Safari / Chrome（iOS & Android） |
| 擴展性 | 支援動態新增門店，品項可後台管理 |

---

## 九、MVP 範圍定義

### MVP 包含（第一階段開發）

**門店端：**
- ✅ 手機掃 QR Code 進入門店物料盤點，輸入架上、庫存、倒掉量
- ✅ 每日結帳表（所有支付方式、實收盤點、鐵櫃盤點、自動計算差額）
- ✅ 每日用量及損耗自動計算
- ✅ 叫貨表單 + 系統自動建議叫貨量
- ✅ 營業號數、上班人力輸入

**中央廚房端：**
- ✅ 各店叫貨需求表 + 各品項加總
- ✅ 出貨表（記錄各店出貨數量）
- ✅ 原物料庫存盤點（含最低庫存警示）
- ✅ 成品庫存盤點
- ✅ 原物料叫貨表

**收貨確認：**
- ✅ 各店上班人員掃碼確認收貨

### MVP 不包含（未來迭代）

- ❌ 老闆報表（日報、週報、月報）
- ❌ 天氣記錄與用量關聯分析
- ❌ 生產排程自動建議
- ❌ 多門店權限管理後台
- ❌ 數據匯出（Excel / PDF）
- ❌ 推播通知（庫存不足通知、叫貨提醒）

---

## 十、名詞定義

| 名詞 | 定義 |
|------|------|
| 打烊盤點 | 每日營業結束後，門店人員清點所有物料的剩餘庫存 |
| 架上 | 目前放在工作台/展示區的物料數量 |
| 庫存 | 放在冷藏/冷凍/倉庫的備用物料數量 |
| 倒掉量 | 當日因過期、品質不良等原因丟棄的物料數量 |
| 叫貨 | 門店向中央廚房提出隔日所需物料的需求 |
| 建議叫貨量 | 系統根據歷史用量和當前庫存自動計算的建議數量 |
| 央廚備料 | 中央廚房根據各店叫貨需求準備的出貨量 |
| 基本量 | 各品項在門店應維持的基本庫存水位 |
| 保存天數 | 品項從製作/開封後可保存的天數 |
| 號數 | 當日POS機出單的總訂單數量 |
| 結帳差額 | 實收金額與應結金額的差異 |
| 最低庫存量 | 原物料在央廚應維持的最低安全庫存 |

---

> **文檔狀態**：✅ 已完成
> **下一步**：輸入 `/設計` 召喚設計師 Agent，開始 UI/UX 設計規劃。
